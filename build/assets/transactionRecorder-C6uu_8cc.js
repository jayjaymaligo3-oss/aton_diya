import{a as l}from"./index-R8E08i6Z.js";const i=async(t,r,a="customer")=>{try{console.log("üìù Recording order transaction:",t.id);const e=JSON.parse(localStorage.getItem("global_orders")||"[]"),o=e.findIndex(n=>n.id===t.id),s={id:t.id,userId:r,userRole:a,customerName:t.shippingInfo?.fullName||t.customer||"Unknown",customer:t.shippingInfo?.fullName||t.customer||"Unknown",date:t.date||new Date().toLocaleDateString(),dateTime:t.dateTime||new Date().toISOString(),items:Array.isArray(t.products)?t.products.length:t.items||0,products:t.products||[],subtotal:t.subtotal||t.total,shippingFee:t.shippingFee||"50.00",total:t.total,status:t.status||"Pending",paymentMethod:t.paymentMethod||"cod",shippingInfo:t.shippingInfo||{},createdAt:t.createdAt||new Date().toISOString(),updatedAt:new Date().toISOString()};o>=0?e[o]=s:e.unshift(s),localStorage.setItem("global_orders",JSON.stringify(e)),console.log("‚úÖ Order saved to localStorage"),c(r);try{await l.post("/admin/orders/sync",{order:s}),console.log("‚úÖ Order synced to database")}catch(n){console.warn("‚ö†Ô∏è Failed to sync order to database:",n.message)}return s}catch(e){throw console.error("‚ùå Error recording order transaction:",e),e}},c=t=>{try{const r=JSON.parse(localStorage.getItem("global_users")||"[]"),a=JSON.parse(localStorage.getItem("global_orders")||"[]"),e=r.findIndex(o=>o.id===t);if(e>=0){const o=a.filter(s=>s.userId===t);r[e].orders=o.length,localStorage.setItem("global_users",JSON.stringify(r)),console.log("‚úÖ User order count updated:",o.length)}}catch(r){console.error("‚ùå Error updating user order count:",r)}},g=async(t,r,a="add")=>{try{console.log(`üìù Recording product ${a}:`,t.name);const e=JSON.parse(localStorage.getItem("global_products")||"[]");if(a==="delete"){const o=e.filter(s=>s.id!==t.id);localStorage.setItem("global_products",JSON.stringify(o))}else{const o={...t,vendorId:r,updatedAt:new Date().toISOString()},s=e.findIndex(n=>n.id===t.id);s>=0?e[s]=o:e.push(o),localStorage.setItem("global_products",JSON.stringify(e))}console.log(`‚úÖ Product ${a} recorded to localStorage`);try{await l.post("/admin/products/sync",{product:a==="delete"?{id:t.id,action:"delete"}:t,vendorId:r,action:a}),console.log("‚úÖ Product synced to database")}catch(o){console.warn("‚ö†Ô∏è Failed to sync product to database:",o.message)}}catch(e){console.error("‚ùå Error recording product transaction:",e)}};export{i as recordOrderTransaction,g as recordProductTransaction};
